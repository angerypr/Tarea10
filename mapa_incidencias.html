<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mapa de Incidencias</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        header {
            background: #0078d4;
            padding: 10px;
            color: white;
            text-align: center;
        }
        #controls {
            padding: 10px;
            background: #f4f4f4;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        #controls select, #controls input {
            padding: 5px;
            border: 1px solid #ccc;
        }
        #map { height: 500px; }
        #list-view { display: none; padding: 10px; }
        .incident {
            border-bottom: 1px solid #ccc;
            padding: 10px 0;
        }
        .btn {
            padding: 6px 12px;
            background: #0078d4;
            color: white;
            border: none;
            cursor: pointer;
        }
        .btn:hover { background: #005fa3; }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 6px;
            width: 400px;
            max-width: 90%;
        }
        .close {
            float: right;
            cursor: pointer;
            font-size: 18px;
            color: red;
        }
    </style>
</head>
<body>

<header>
    <h1>Mapa de Incidencias - Últimas 24 horas</h1>
</header>

<div id="controls">
    <select id="filter-provincia">
        <option value="">Todas las provincias</option>
        <option value="Santo Domingo">Santo Domingo</option>
        <option value="Santiago">Santiago</option>
    </select>
    <select id="filter-tipo">
        <option value="">Todos los tipos</option>
        <option value="Accidente">Accidente</option>
        <option value="Robo">Robo</option>
        <option value="Pelea">Pelea</option>
    </select>
    <input type="date" id="filter-fecha">
    <input type="text" id="search-titulo" placeholder="Buscar por título">
    <button class="btn" id="toggle-view">Vista Lista</button>
</div>

<div id="map"></div>
<div id="list-view"></div>

<!-- Modal -->
<div id="incident-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="modal-title"></h3>
        <p id="modal-description"></p>
        <h4>Comentarios</h4>
        <textarea placeholder="Escribe un comentario..." style="width:100%;height:60px;"></textarea>
        <button class="btn">Enviar comentario</button>
        <h4>Sugerir corrección</h4>
        <label>Muertos: <input type="number" min="0"></label><br>
        <label>Heridos: <input type="number" min="0"></label><br>
        <label>Provincia: <input type="text"></label><br>
        <label>Municipio: <input type="text"></label><br>
        <label>Pérdida estimada RD$: <input type="number"></label><br>
        <label>Coordenadas: <input type="text" placeholder="lat, lng"></label><br>
        <button class="btn">Enviar corrección</button>
    </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- MarkerCluster JS -->
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<script>
    // Datos ficticios
    const incidencias = [
        { titulo: "Accidente en Av. 27", tipo: "Accidente", lat: 18.479, lng: -69.9, provincia: "Santo Domingo", fecha: "2025-08-10", descripcion: "Choque múltiple con 2 heridos." },
        { titulo: "Robo en tienda", tipo: "Robo", lat: 18.48, lng: -69.91, provincia: "Santo Domingo", fecha: "2025-08-10", descripcion: "Asalto a mano armada en supermercado." },
        { titulo: "Pelea en barrio", tipo: "Pelea", lat: 19.45, lng: -70.7, provincia: "Santiago", fecha: "2025-08-09", descripcion: "Disputa entre vecinos terminó en pelea." }
    ];

    // Iconos
    const iconos = {
        "Accidente": L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/619/619034.png', iconSize: [32, 32] }),
        "Robo": L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png', iconSize: [32, 32] }),
        "Pelea": L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/1055/1055646.png', iconSize: [32, 32] })
    };

    // Mapa
    const map = L.map('map').setView([18.5, -70], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const markers = L.markerClusterGroup();

    incidencias.forEach(inc => {
        const marker = L.marker([inc.lat, inc.lng], { icon: iconos[inc.tipo] })
            .bindPopup(`<b>${inc.titulo}</b><br>${inc.tipo}`)
            .on('click', () => abrirModal(inc));
        markers.addLayer(marker);
    });

    map.addLayer(markers);

    // Modal
    const modal = document.getElementById("incident-modal");
    const spanClose = document.getElementsByClassName("close")[0];
    spanClose.onclick = () => modal.style.display = "none";
    window.onclick = e => { if (e.target == modal) modal.style.display = "none"; };

    function abrirModal(inc) {
        document.getElementById("modal-title").innerText = inc.titulo;
        document.getElementById("modal-description").innerText = inc.descripcion;
        modal.style.display = "block";
    }

    // Vista lista
    document.getElementById("toggle-view").onclick = () => {
        const mapDiv = document.getElementById("map");
        const listDiv = document.getElementById("list-view");
        if (mapDiv.style.display !== "none") {
            mapDiv.style.display = "none";
            listDiv.style.display = "block";
            listDiv.innerHTML = incidencias.map(inc => `
                <div class="incident">
                    <h3>${inc.titulo}</h3>
                    <p>${inc.descripcion}</p>
                    <button class="btn" onclick='abrirModal(${JSON.stringify(inc)})'>Ver detalles</button>
                </div>
            `).join("");
            document.getElementById("toggle-view").innerText = "Vista Mapa";
        } else {
            mapDiv.style.display = "block";
            listDiv.style.display = "none";
            document.getElementById("toggle-view").innerText = "Vista Lista";
        }
    };
</script>

</body>
</html>
